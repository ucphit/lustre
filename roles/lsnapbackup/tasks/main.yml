---
- name: Make the directory for adm scripts
  ansible.builtin.file:
    path: /lustre/adm
    state: directory

- name: Make the directory for python modules
  ansible.builtin.file:
    path: /lustre/adm/modules
    state: directory

- name: Copy python modules
  ansible.builtin.copy:
    src: "{{ item }}"
    dest: /lustre/adm/modules
    owner: root
    group: root
    mode: u=rwx,g=rwx,o=r
  with_fileglob:
    - "plugins/module_utils/*"

- name: Copy script to mgs
  ansible.builtin.copy:
    src: "files/adm/lustre_snapbackup.py"
    dest: /lustre/adm/
    owner: root
    group: root
    mode: u=rwx,g=rwx,o=r

- name: Copy service to mgs
  ansible.builtin.copy:
    src: "files/services/lsnapbackup.service"
    dest: /etc/systemd/system/
    owner: root
    group: root
    mode: u=rwx,g=rwx,o=r

- name: Reload systemd
  ansible.builtin.systemd:
    daemon_reload: true

- name: Start lsnapbackup service
  ansible.builtin.systemd:
    name: lsnapbackup.service
    state: started
    enabled: yes